{% extends 'base.html' %}

{% block title %}Scoreboard{% endblock %}

{% block content %}

<!-- Default Page to Enter Race ID -->
<div id="default-scoreboard" style="text-align: center; margin-top: 50px;">
    <h2>Enter Race ID</h2>
    <form id="race-id-form">
        <label for="race-id-input">Race ID:</label>
        <input type="text" id="race-id-input" name="race_id" required>
        <button type="submit">Go to Scoreboard</button>
    </form>
    <p id="error-message" style="color:red; display:none;">Invalid Race ID. Please try again.</p>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Handle the form submission for race ID
        document.getElementById('race-id-form').addEventListener('submit', function (event) {
            event.preventDefault();  // Prevent the default form submission

            const raceId = document.getElementById('race-id-input').value;  // Get the race ID input value
            const errorMessage = document.getElementById('error-message');  // Get the error message element

            // Check if race ID is provided
            if (!raceId) {
                errorMessage.textContent = "Please enter a valid race ID.";
                errorMessage.style.display = "block";
                return;
            }

            // Fetch race information from the backend to verify if the race exists
            fetch(`/api/verify_race?race=${raceId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Race not found');
                    }
                    return response.json();
                })
                .then(data => {
                    // If the race exists, redirect to the scoreboard page
                    window.location.href = `/scoreboard?race=${raceId}`;  // Redirect to the scoreboard page with the race ID
                })
                .catch(error => {
                    // If race is not found, show error message
                    errorMessage.textContent = "Race not found. Please try again.";
                    errorMessage.style.display = "block";
                });
        });
    });
</script>

{% endblock %}
