{% extends 'base.html' %}

{% block title %}Scoreboard{% endblock %}

{% block content %}
<h1>Scoreboard</h1>

<!-- Main Tabs -->
{% include 'scoreboard/tabs.html' %}

<!-- Scoreboard Tab Content -->
<div id="scoreboard" class="tabcontent">

    <!-- Sub-tabs only visible inside the Scoreboard tab -->
    <div class="tab">
        <button class="subTablinks" onclick="openSubTab(event, 'classement')">Classement</button>
        <button class="subTablinks" onclick="openSubTab(event, 'sprint')">Sprint</button>
        <button class="subTablinks" onclick="openSubTab(event, 'mountain')">King of the Mountain</button>
    </div>

    <!-- Sub-tab content (IDs and classes are inside each included file) -->
    {% include 'scoreboard/classement.html' %}
    {% include 'scoreboard/sprint.html' %}
    {% include 'scoreboard/mountain.html' %}
</div>

<!-- Stages Tab Content -->
<div id="stages" class="tabcontent" style="display:none;">
    {% include 'scoreboard/stage_selector.html' %}
    {% include 'scoreboard/stage_tab.html' %}
</div>
{% endblock %}

{% block scripts %}
<script>
// Add event listener to the scoreboard tab
document.addEventListener("DOMContentLoaded", function () {
    // When the user clicks the "Scoreboard" tab, fetch the classement data
    const scoreboardTab = document.getElementById("scoreboard");

    if (scoreboardTab) {
        scoreboardTab.addEventListener('click', function () {
            // Trigger fetching of classement data when the scoreboard tab is clicked
            fetchClassementData();
        });
    }

    // Function to fetch classement data
    function fetchClassementData() {
        const raceId = '{{ race_id }}';  // Ensure the race_id is accessible in the template

        fetch(`/scoreboard?race=${raceId}`)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Handle the response and update the classement table
                    updateClassementTable(data.classement_data);
                } else {
                    console.error('Error fetching classement data:', data.message);
                }
            })
            .catch(error => {
                console.error('Error fetching classement data:', error);
            });
    }

    // Function to update the classement table with the fetched data
    function updateClassementTable(classementData) {
        const classementTable = document.querySelector("#classement-table");  // Make sure you have this table in your HTML
        if (classementTable) {
            // Clear the existing table data
            classementTable.innerHTML = '';
            
            // Add new rows (Assuming the data is an array of objects, you can adjust based on your actual data)
            classementData.forEach(data => {
                let row = classementTable.insertRow();
                let cell1 = row.insertCell(0);
                let cell2 = row.insertCell(1);
                let cell3 = row.insertCell(2);
                cell1.innerHTML = data.team;
                cell2.innerHTML = data.rider;
                cell3.innerHTML = data.placement;
            });
        }
    }
});
</script>
{% endblock %}
