{% extends 'base.html' %}

{% block title %}Scoreboard{% endblock %}

{% block content %}
<h1>Scoreboard</h1>

<!-- Main Tabs -->
{% include 'scoreboard/tabs.html' %}

<!-- Scoreboard Tab Content -->
<div id="scoreboard" class="tabcontent">
    <div class="tab">
        <button class="subTablinks" onclick="openSubTab(event, 'classement')">Classement</button>
        <button class="subTablinks" onclick="openSubTab(event, 'sprint')">Sprint</button>
        <button class="subTablinks" onclick="openSubTab(event, 'mountain')">King of the Mountain</button>
    </div>

    <!-- Sub-tab content (IDs and classes are inside each included file) -->
    {% include 'scoreboard/classement.html' %}
    {% include 'scoreboard/sprint.html' %}
    {% include 'scoreboard/mountain.html' %}
</div>

<!-- Stages Tab Content -->
<div id="stages" class="tabcontent" style="display:none;">
    {% include 'scoreboard/stage_selector.html' %}
    {% include 'scoreboard/stage_tab.html' %}
</div>
{% endblock %}

{% block scripts %}
<script>
// Add event listener to the scoreboard tab
document.addEventListener("DOMContentLoaded", function () {
    const scoreboardTab = document.getElementById("scoreboard");

    if (scoreboardTab) {
        scoreboardTab.addEventListener('click', function () {
            // Trigger fetching of classement data when the scoreboard tab is clicked
            fetchClassementData();
        });
    }

    // Function to fetch classement data
    function fetchClassementData() {
        const raceId = '{{ race_id }}';  // Ensure the race_id is accessible in the template

        // Log the event trigger
        console.log(`Event triggered, fetching data for race_id: ${raceId}`);

        // Make the fetch request
        fetch(`/scoreboard?race=${raceId}`)
            .then(response => response.json())
            .then(data => {
                // Log the fetched data to see if we are receiving it properly
                console.log("Fetched data:", data);

                // Now process and display the data (classement_data)
                const classementData = data.classement_data;
                console.log("Classement Data to be displayed:", classementData);

                // Placeholder to display classement data in console
                for (let stageId in classementData) {
                    console.log(`Stage ${stageId}:`);
                    for (let teamId in classementData[stageId]) {
                        for (let riderId in classementData[stageId][teamId]) {
                            const placement = classementData[stageId][teamId][riderId];
                            console.log(`Team ${teamId}, Rider ${riderId} - Placement: ${placement}`);
                        }
                    }
                }
            })
            .catch(error => {
                console.error('Error fetching classement data:', error);
            });
    }
});
</script>
{% endblock %}
