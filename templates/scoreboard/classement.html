<div id="classement" class="subTabcontent">
    <h2>Classement</h2>
    <table>
        <thead>
            <tr>
                <th rowspan="2">Stage</th>
                {% for team in team_names %}
                    <th colspan="{{ assistant }}">{{ team }}</th>
                {% endfor %}
            </tr>
            <tr>
                {% for team_id in rider_names %}
                    {% for rider in rider_names[team_id] %}
                        <th>{{ rider }}</th>
                    {% endfor %}
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for stage in range(stages) %}
                <tr>
                    <td>Stage {{ stage + 1 }}</td>
                    {% for team_id in rider_names %}
                        {% for rider_index, rider in enumerate(rider_names[team_id]) %}
                            <td id="classement-stage-{{ stage + 1 }}-team-{{ team_id }}-rider-{{ rider_index }}">
                                {% set rider_id = rider_ids[team_id][rider_index] %}
                                {% set stage_id = stage_data[stage].id %}  <!-- Fetch the stage_id from the stage_data -->

                                <!-- Debugging: Log stage_id, team_id, rider_id to verify -->
                                {% if loop.index == 1 %}
                                    <script>
                                        console.log("stage_id:", {{ stage_id }});
                                        console.log("team_id:", {{ team_id }});
                                        console.log("rider_id:", {{ rider_id }});
                                    </script>
                                {% endif %}

                                <!-- Check if stage_id, team_id, and rider_id exist in classement_data -->
                                {% set placement = classement_data[stage_id] is defined and classement_data[stage_id][team_id] is defined and classement_data[stage_id][team_id][rider_id] is defined
                                    and classement_data[stage_id][team_id][rider_id] or '' %}
                                {{ placement }}
                            </td>
                        {% endfor %}
                    {% endfor %}

                </tr>
            {% endfor %}

            <tr>
                <td>Total</td>
                {% for team_id in rider_names %}
                    {% for rider_index, rider in enumerate(rider_names[team_id]) %}
                        <td id="classement-total-team-{{ team_id }}-rider-{{ rider_index }}">
                            {% set rider_id = rider_ids[team_id][rider_index] %}
                            {% set total = 0 %}
                            {% for stage_id in stage_data %}
                                {% set placement = classement_data[stage_id.id][team_id][rider_id] %}
                                {% if placement %}
                                    {% set total = total + placement %}
                                {% endif %}
                            {% endfor %}
                            {{ total }}
                        </td>
                    {% endfor %}
                {% endfor %}
            </tr>
        </tbody>
    </table>
</div>
